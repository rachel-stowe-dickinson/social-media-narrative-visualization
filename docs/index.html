---
layout: default
---
<script src="https://d3js.org/d3.v4.min.js"></script>

<style>
  #platformSelection{
    display:block;
    margin: 20px auto;
    font-size: 16px;
  }
  .sceneheader {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    width: 100%;
    box-sizing: border-box;
  }
  .sceneheader div {
    flex: 1;
    max-width: 33%;
  }
  .selectbox {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 10px;
  }
  .selectbox h5 {
    margin: 0; 
  }
  h4 {
    text-align: center;
  }
  .scene {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    width: 100%;
    padding: 10px;
    box-sizing: border-box;
  }
  .scene svg {
    flex: 1;
    max-width: 33%;
    aspect-ratio: 6/5;
    border: 1px solid #ccc;
    background-color: white;
  }
  #tooltip {
    opacity: 0; 
    padding: 5px; 
    background:#eee; 
    position:absolute; 
    z-index:1000; 
    pointer-events: none;
    border-radius: 4px;
    font-size: 12px;
  }
</style>

<h1>A Visual Exploration of Social Media Engagement</h1>
<h4>Select a Platform:</h4>
<select id="platformSelection"></select>
<h2>Average Engagement by Post Type</h2>
<div class="sceneheader">
  <div><h4>Average Like Count</h4></div>
  <div><h4>Average Comment Count</h4></div>
  <div><h4>Average Share Count</h4></div>
</div>
<div class="scene">
  <svg id="chart1" width="100%"></svg>
  <svg id="chart2" width="100%"></svg>
  <svg id="chart3" width="100%"></svg>
</div>
<h2>Average Engagement by Tone</h2>
<div class="selectbox">
  <h5>Select a Post Type:</h5>
  <select id="typeSelection"></select>
</div>
<div class="sceneheader">
  <div><h4>Average Like Count</h4></div>
  <div><h4>Average Comment Count</h4></div>
  <div><h4>Average Share Count</h4></div>
</div>
<div class="scene">
  <svg id="chart4" width="100%"></svg>
  <svg id="chart5" width="100%"></svg>
  <svg id="chart6" width="100%"></svg>
</div>
<h2>Average Engagement by Post Day</h2>
<div class="selectbox">
  <h5>Select a Post Type:</h5>
  <select id="typeSelection2"></select>
</div>
<div class="sceneheader">
  <div><h4>Average Like Count</h4></div>
  <div><h4>Average Comment Count</h4></div>
  <div><h4>Average Share Count</h4></div>
</div>
<div class="scene">
  <svg id="chart7" width="100%"></svg>
  <svg id="chart8" width="100%"></svg>
  <svg id="chart9" width="100%"></svg>
</div>
<h2>Individual Engagement by Post Time</h2>
<div class="selectbox">
  <h5>Select a Post Type:</h5>
  <select id="typeSelection3"></select>
</div>
<div class="selectbox">
  <h5>Select a Post Day:</h5>
  <select id="daySelection"></select>
</div>
<div class="sceneheader">
  <div><h4>Like Count</h4></div>
  <div><h4>Comment Count</h4></div>
  <div><h4>Share Count</h4></div>
</div>
<div class="scene">
  <svg id="chart10" width="100%"></svg>
  <svg id="chart11" width="100%"></svg>
  <svg id="chart12" width="100%"></svg>
</div>
<div id="tooltip"></div>
<script>
  // Define tooltip
  const tooltip = d3.select("#tooltip");

  // Colors for specific platform
  const platforms = ["Facebook", "Instagram", "Twitter", "LinkedIn"]
  const post_types = ["Image", "Video", "Link"]
  const post_tones = ["Positive", "Mixed", "Negative", "Neutral"]
  const post_days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]
  var platformColor = d3.scaleOrdinal().domain(platforms).range(["royalblue", "tomato", "mediumpurple", "midnightblue"]);
  const postTypeSymbol = d3.scaleOrdinal()
    .domain(["Image","Video","Link"])
    .range([d3.symbolCircle, d3.symbolSquare, d3.symbolTriangle]);

  // Function for creating a bar chart
  function barChart(chartId, data, xattr, yattr, yattr2, ydomain, platform){
    var chart = d3.select("#"+chartId);
    var color = platformColor(platform);
    var l_margin = 70, r_margin = 20, t_margin = 20, b_margin = 50;
    var width = chart.node().getBoundingClientRect().width - (l_margin+r_margin);
    var height = chart.node().getBoundingClientRect().width*5/6 - (t_margin+b_margin);
    chart.attr("height", height + (t_margin+b_margin));

    var g = chart.select("g");
    if (g.empty()){
      g = chart.append("g")
        .attr("transform", "translate("+l_margin+","+t_margin+")");
    }           

    var avgData = d3.nest()
      .key(d => d[yattr])
      .rollup(values => d3.mean(values, d => d[xattr]))
      .entries(data)
      .map(d => ({ [yattr]: d.key, avg: d.value }));
    var avgMap = {};
    avgData.forEach(function(d) {
      avgMap[d[yattr]] = d.avg;
    });
    avgData = ydomain.map(val => ({
      [yattr]: val,
      avg: avgMap[val] != null ? avgMap[val] : 0
    }));

    var y = d3.scaleBand()
      .domain(ydomain)
      .range([0,height])
      .padding(0.2);

    var x = d3.scaleLinear()
      .domain([0,d3.max(avgData, d => d.avg)])
      .range([0,width]);

    const maxAvg = d3.max(avgData, d => d.avg);
    const maxDatum = avgData.find(d => d.avg === maxAvg);
    const maxLabel = g.selectAll("text.max-label")
      .data([maxDatum]);
    maxLabel.enter()
      .append("text")
        .attr("class","max-label")
      .merge(maxLabel)
        .attr("x", d => x(d.avg) / 2)                     
        .attr("y", d => y(d[yattr]) + y.bandwidth() / 2)  
        .attr("dy", "0.35em")                             
        .attr("text-anchor", "middle")
        .attr("fill", "#fff")
        .style("pointer-events","none")                   
        .text(d => `Best ${yattr.split("_").join(" ")}: ${d[yattr]}`);
    maxLabel.exit().remove();

    var yAxis = g.select(".yaxis");
    if (yAxis.empty()) {
      yAxis = g.append("g").attr("class", "yaxis");
    }

    yAxis.transition()
      .duration(600)
      .call(d3.axisLeft(y));

    var xAxis = g.select(".xaxis");
    if (xAxis.empty()) {
      xAxis = g.append("g")
        .attr("class", "xaxis")
        .attr("transform", "translate(0," + height + ")");
    }
    xAxis.transition()
      .duration(600)
      .call(d3.axisBottom(x).ticks(5));
    xAxis.selectAll(".tick text")
      .attr("transform", "rotate(-45)")
      .style("text-anchor", "end")
      .attr("dx", "-0.8em")
      .attr("dy", "0.15em");   
      
    yAxis.append("text")
      .attr("class", "axis-label")
      .attr("transform", "rotate(-90)")  
      .attr("x", -height / 2)           
      .attr("y", -55)                    
      .style("text-anchor", "middle")
      .style("fill", "#000")
      .style("font-weight", "bold")
      .text(yattr.split("_").join(" "));  

    xAxis.append("text")
      .attr("class", "axis-label")
      .attr("x", width / 2)              
      .attr("y", 40)                     
      .style("text-anchor", "middle")
      .style("fill", "#000")
      .style("font-weight", "bold")
      .text(xattr);  

    var bars = g.selectAll("rect")
      .data(avgData, d => d[yattr]);
    bars.enter()
      .append("rect")
      .attr("x", 0)
      .attr("y", function(d) { return y(d[yattr]); })
      .attr("height", y.bandwidth())
      .attr("width",0)
      .attr("fill", color)
      .merge(bars)
      .attr("stroke",      d => d.avg === maxAvg ? "black" : "none")
      .attr("stroke-width",d => d.avg === maxAvg ? 2         : 0) 
      .on("mouseover", function(d){
        d3.select(this)
          .transition().duration(100)
          .attr("fill", "gray");
        tooltip.transition()
          .duration(200)
          .style("opacity",1);
        tooltip.html("<strong>"+platform+": "+d[yattr]+yattr2+"</strong><br>Average number of "+xattr+": <strong>"+d.avg.toFixed(0)+"</strong>");
      })
      .on("mousemove", function(event){
        tooltip.style("left",(d3.event.pageX + 10)+"px")
          .style("top",(d3.event.pageY + 10)+"px")
      })
      .on("mouseout", function(){
        d3.select(this)
          .transition().duration(100)
          .attr("fill", color);
        tooltip.transition()
          .duration(200)
          .style("opacity", 0);
      })
      .transition()
      .duration(600)
      .attr("width", function(d) {return x(d.avg)})
      .attr("fill", color);
    
    bars.transition()
      .duration(600)
      .attr("y", function(d) {return y(d[yattr])})
      .attr("width", function(d) {return x(d.avg)})
      .attr("fill", color);

    bars.exit().remove();

    g.selectAll("text.max-label").raise();
  }

  // Function for creating a scatterplot
  function scatter(chartId, data, xattr, yattr, platform){
    var chart = d3.select("#"+chartId);
    var color = platformColor(platform);
    var l_margin = 70, r_margin = 20, t_margin = 20, b_margin = 50;
    var width = chart.node().getBoundingClientRect().width - (l_margin+r_margin);
    var height = chart.node().getBoundingClientRect().width*5/6 - (t_margin+b_margin);
    chart.attr("height", height + (t_margin+b_margin));

    var parseHour = d3.timeParse("%m/%d/%Y %H:%M");
    data.forEach(d => {
      d.time = new Date(2000,0,1,parseHour(d[xattr]).getHours(),parseHour(d[xattr]).getMinutes()); 
    });

    var g = chart.select("g");
    if (g.empty()){
      g = chart.append("g")
        .attr("transform", "translate("+l_margin+","+t_margin+")");
    }   
    
    const maxVal = d3.max(data, d => d[xattr]);
    const maxDatum = data.find(d => d[xattr] === maxVal);
    const info = g.selectAll("g.info")
      .data([maxDatum]);
    const infoEnter = info.enter()
      .append("g")
        .attr("class", "info");
    infoEnter.append("rect")
        .attr("x", width - 160) 
        .attr("y", 0)
        .attr("width", 150)
        .attr("height", 30)
        .attr("fill", "white")
        .attr("stroke", "black");
    infoEnter.append("text")
        .attr("x", width - 155)   
        .attr("y", 20)
        .attr("fill", "black")
        .style("font-size", "12px")
        .text(`Best ${yattr.split("_").join(" ")}: ${maxDatum[yattr]}`);
    info.exit().remove();

    var y = d3.scaleTime()
      .domain([new Date(2000,0,1,0),new Date(2000,0,1,23,59)])
      .range([0,height]);

    var x = d3.scaleLinear()
      .domain([0,d3.max(data, d => d[yattr])])
      .range([0,width]);

    var yAxis = g.select(".yaxis");
    if (yAxis.empty()) {
      yAxis = g.append("g").attr("class", "yaxis");
    }
    yAxis.transition()
      .duration(600)
      .call(d3.axisLeft(y)
        .ticks(d3.timeHour.every(3))
        .tickFormat(d3.timeFormat("%H:%M")));

    var xAxis = g.select(".xaxis");
    if (xAxis.empty()) {
      xAxis = g.append("g")
        .attr("class", "xaxis")
        .attr("transform", "translate(0," + height + ")");
    }
    xAxis.transition()
      .duration(600)
      .call(d3.axisBottom(x));
    xAxis.selectAll(".tick text")
      .attr("transform", "rotate(-45)")
      .style("text-anchor", "end")
      .attr("dx", "-0.8em")
      .attr("dy", "0.15em");

    xAxis.append("text")
      .attr("class", "axis-label")
      .attr("x", width / 2)              
      .attr("y", 40)                     
      .style("text-anchor", "middle")
      .style("fill", "#000")
      .style("font-weight", "bold")
      .text(yattr);              

    yAxis.append("text")
      .attr("class", "axis-label")
      .attr("transform", "rotate(-90)")  
      .attr("x", -height / 2)           
      .attr("y", -55)                    
      .style("text-anchor", "middle")
      .style("fill", "#000")
      .style("font-weight", "bold")
      .text(xattr.split("_").join(" ")); 

    var symbols = g.selectAll("path.symbol")
      .data(data, d => d.time + "-" + d[yattr])

    var symbols_enter = symbols.enter()
      .append("path")
      .attr("class", "symbol")
      .attr("fill", color)
      .attr("d", d3.symbol().size(40)
                       .type(d => postTypeSymbol(d.post_type) || d3.symbolCircle))
      .attr("transform", d =>
        `translate(${x(d[yattr])},${y(d.time)})`
      )
      .attr("opacity", 0);

    symbols_enter.merge(symbols)
      .attr("stroke",      d => d.avg === maxVal ? "black" : "none")
      .attr("stroke-width",d => d.avg === maxVal ? 2  : 0) 
      .attr("fill",d => d.avg === maxVal ? "greenyellow" : color) 
      .attr("d", d3.symbol().size(40)
                       .type(d => postTypeSymbol(d.post_type) || d3.symbolCircle))
      .transition()
        .duration(600)
        .attr("transform", d => 
        `translate(${x(d[yattr])},${y(d.time)})`)
        .attr("opacity", 1);

    symbols.exit()
      .transition().duration(300)
      .attr("opacity", 0)
      .remove();

    g.selectAll("path.symbol")
      .on("mouseover", function(d){
        d3.select(this)
          .transition().duration(100)
          .attr("fill", "gray");
        tooltip.transition()
          .duration(200)
          .style("opacity",1);
        tooltip.html(`<strong>${platform} ${d.post_type}</strong><br>` +
                      `Day: <strong>${d.post_day}</strong><br>` + 
                      `Time: <strong>${d3.timeFormat("%H:%M")(d.time)}</strong><br>` +
                      `Number of ${yattr}: <strong>${d[yattr]}</strong>`);
      })
      .on("mousemove", function(event){
        tooltip.style("left",(d3.event.pageX + 10)+"px")
          .style("top",(d3.event.pageY + 10)+"px")
      })
      .on("mouseout", function(){
        d3.select(this)
          .transition().duration(100)
          .attr("fill", color);
        tooltip.transition()
          .duration(200)
          .style("opacity", 0);
      });
  }
  
  // Load CSV data
  d3.csv("social_media_engagement_data.csv", function(rawData) {
    // Use only a sample of CSV file (LARGE-100k rows)
    const SAMPLE_SIZE = 20000;
    const data = d3.shuffle(rawData).slice(0, SAMPLE_SIZE);
    data.forEach(d => {
      d.likes = +d.likes;
      d.comments = +d.comments;
      d.shares = +d.shares;
      if (!d.sentiment_score || d.sentiment_score.trim() === "") {
        d.sentiment_score = "Mixed";
      }
    });

    // Function for updating all charts with new platform selection
    function updateCharts(platform){
      var filteredData = data.filter(function(d) {return d.platform == platform});
      barChart("chart1", filteredData, "likes", "post_type", "", post_types, platform);
      barChart("chart2", filteredData, "comments", "post_type", "", post_types, platform);
      barChart("chart3", filteredData, "shares", "post_type", "", post_types, platform);
      barChart("chart4", filteredData, "likes", "sentiment_score", " Post", post_tones, platform);
      barChart("chart5", filteredData, "comments", "sentiment_score", " Post", post_tones, platform);
      barChart("chart6", filteredData, "shares", "sentiment_score", " Post", post_tones, platform);
      barChart("chart7", filteredData, "likes", "post_day", " Post", post_days, platform);
      barChart("chart8", filteredData, "comments", "post_day", " Post", post_days, platform);
      barChart("chart9", filteredData, "shares", "post_day", " Post", post_days, platform);
      scatter("chart10", filteredData, "post_time", "likes", platform);
      scatter("chart11", filteredData, "post_time", "comments", platform);
      scatter("chart12", filteredData, "post_time", "shares", platform);
    }

    // Function for updating a row of charts with post type selection
    function typeFilterUpdate(charts, attr, type, attr_list){
      var platform = d3.select("#platformSelection").node().value;
      var filteredData = data.filter(function(d) {return d.platform == platform});
      var desc = " " + type;
      if (type != "All"){
        filteredData = data.filter(function(d) {return d.platform == platform && d.post_type == type});
      } else {
        desc = " post";
      }
      barChart(charts[0], filteredData, "likes", attr, desc, attr_list, platform);
      barChart(charts[1], filteredData, "comments", attr, desc, attr_list, platform);
      barChart(charts[2], filteredData, "shares", attr, desc, attr_list, platform);
    }

    // Function for updating the final row with post day and type selection
    function typeDayFilterUpdate(type, day){
      var platform = d3.select("#platformSelection").node().value;
      var filteredData = data.filter(function(d) {return d.platform == platform});
      if (type != "All"){
        filteredData = filteredData.filter(function(d) {return d.post_type == type});
      }
      if (day != "All"){
        filteredData = filteredData.filter(function(d) {return d.post_day == day});
      }
      scatter("chart10", filteredData, "post_time", "likes", platform);
      scatter("chart11", filteredData, "post_time", "comments", platform);
      scatter("chart12", filteredData, "post_time", "shares", platform);
    }

    // Function for populating values of a dropdown list
    function populateDropdown (id, options, allowAll){
      var dropdown = d3.select(id);
      vals = options;
      if (allowAll){
        vals = ["All", ...options];
      }
      dropdown.selectAll("option")
        .data(vals)
        .enter()
        .append("option")
        .text(function(d) {return d;})
        .attr("value", function(d) {return d;});
      return dropdown;
    }

    // Platform selection dropdown
    var select_platform = populateDropdown("#platformSelection", platforms, false);

    // Type selection dropdowns
    var select_type = populateDropdown("#typeSelection", post_types, true);
    var select_type2 = populateDropdown("#typeSelection2", post_types, true);
    var select_type3 = populateDropdown("#typeSelection3", post_types, true);

    // Day selection dropdown
    var select_day = populateDropdown("#daySelection", post_days, true);

    // Update all charts with platform selection (initial selection: Facebook)
    updateCharts("Facebook");
    select_platform.on("change", function(){
      updateCharts(this.value);
      d3.select("#typeSelection").property("value", "All");
      d3.select("#typeSelection2").property("value", "All");
      d3.select("#typeSelection3").property("value", "All");
      d3.select("#daySelection").property("value", "All");
    });

    // Update specified row with type selection (initial selection: All)
    select_type.on("change", function(){
      typeFilterUpdate(["chart4","chart5","chart6"], "sentiment_score", this.value, post_tones);
    });
    select_type2.on("change", function(){
      typeFilterUpdate(["chart7","chart8","chart9"], "post_day", this.value, post_days);
    });

    // Update final row with type AND/OR day selection (initial selection: All)
    select_type3.on("change", function(){
      typeDayFilterUpdate(this.value, d3.select("#daySelection").node().value);
    });
    select_day.on("change", function(){
      typeDayFilterUpdate(d3.select("#typeSelection3").node().value, this.value);
    });

  });
</script>

